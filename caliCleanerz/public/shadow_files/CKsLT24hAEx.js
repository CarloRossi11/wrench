;/*FB_PKG_DELIM*/

__d("LSDataTraceType",[],(function(t,n,r,o,a,i){var e=Object.freeze({TASK:1,SYNC:2,RECEIVE_MSG:3,RICH_MEDIA_SEND:4,RICH_MEDIA_DOWNLOAD:5,TASK_CLIENT_MODE:6,ENCRYPTED_BACKUPS_FETCH_BACKUP_STATUS:69,ENCRYPTED_BACKUPS_INIT:70,ENCRYPTED_BACKUPS_ADD_DEVICE:71,ENCRYPTED_BACKUPS_UPLOAD:72,ENCRYPTED_BACKUPS_RESTORE:73,ENCRYPTED_BACKUPS_DELETE_BACKUP:75,ENCRYPTED_BACKUPS_CREATE_EXTRA_VIRTUAL_DEVICE:76,ENCRYPTED_BACKUPS_QR_ADD_DEVICE:77,ENCRYPTED_BACKUPS_SYNC_EPOCHS:78,ENCRYPTED_BACKUPS_OPEN_EPOCH:79,ENCRYPTED_BACKUPS_OPT_OUT_OF_BACKUP:80,ENCRYPTED_BACKUPS_MEDIA_BACKUP:81,ENCRYPTED_BACKUPS_MEDIA_RESTORE:82,ENCRYPTED_BACKUPS_THIRD_PARTY_ID_GENERATION:83,ENCRYPTED_BACKUPS_FETCH_BACKUPS_METADATA:86,ENCRYPTED_BACKUPS_REMOVE_VIRTUAL_DEVICE:87,ENCRYPTED_BACKUPS_QR_ADD_DEVICE_RECEIVER:88,ENCRYPTED_BACKUPS_DERIVE_AND_STORE_EPOCHS:89,ENCRYPTED_BACKUPS_GET_OPEN_EPOCH_KEYS:90,ENCRYPTED_BACKUPS_END_TO_END_THREAD_RESTORE:190,SAP_VESTA_REGISTRATION:251,SAP_VESTA_LOGIN:252,ENCRYPTED_BACKUPS_SHADOW_FETCH_BACKUP_STATUS:197,ENCRYPTED_BACKUPS_SHADOW_INIT:198,ENCRYPTED_BACKUPS_SHADOW_ADD_DEVICE:199,ENCRYPTED_BACKUPS_SHADOW_UPLOAD:200,ENCRYPTED_BACKUPS_SHADOW_RESTORE:201,ENCRYPTED_BACKUPS_SHADOW_DELETE_BACKUP:203,ENCRYPTED_BACKUPS_SHADOW_CREATE_EXTRA_VIRTUAL_DEVICE:204,ENCRYPTED_BACKUPS_SHADOW_QR_ADD_DEVICE:205,ENCRYPTED_BACKUPS_SHADOW_SYNC_EPOCHS:206,ENCRYPTED_BACKUPS_SHADOW_OPEN_EPOCH:207,ENCRYPTED_BACKUPS_SHADOW_QR_ADD_DEVICE_RECEIVER:216,ENCRYPTED_BACKUPS_ENCRYPTION_VERSIONING_UPSERT_VERSION_DATA:240,ENCRYPTED_BACKUPS_ENCRYPTION_VERSIONING_DELETE_VERSION_DATA:241,ENCRYPTED_BACKUPS_ENCRYPTION_VERSIONING_SYNC_VERSION_DATA:242,ENCRYPTED_BACKUPS_MESSAGE_INTEGRITY_CHECKER:243});i.default=e}),66);
__d("LSDataTraceFlush",["ArmadilloDataTraceType","I64","LSDataTraceType","LSIntEnum","ODS","Promise","ReQL","asyncToGeneratorRuntime","clearTimeout","gkx","promiseDone","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=(s||(s=o("I64"))).of_string("120000"),m=s.of_string("600000"),p=new Set(["encrypted_backups_upload","encrypted_backups_media_backup"]);function _(e,t,n){var r=e.length;if(r===0)return[(s||(s=o("I64"))).neg_one,s.neg_one,void 0,void 0,void 0];var a=e.find(function(e){return e.errorMessage!=null}),i=a==null?void 0:a.errorMessage,l=e[e.length-1|0],u=(s||(s=o("I64"))).of_float(Date.now()),c=l.timestampMs,m=s.compare(s.sub(u,n),d)>=0;return!t&&m?[(s||(s=o("I64"))).sub(u,n),l.checkPointId,c,i,"trace expired"]:[s.sub(c,n),l.checkPointId,c,i,i]}function f(e){return e.reduce(function(e,t,n){var r,a=(s||(s=o("I64"))).to_string(t.checkPointId),i=t.timestampMs,l=s.to_string((r=t.syncChannel)!=null?r:(s||(s=o("I64"))).neg_one),u=t.tags,c=u!=null?","+u:"";if(n===0)e.pointsList="".concat("(",a,",",l,c,")");else{var d=String((s||(s=o("I64"))).to_int32(s.sub(i,e.lastCheckPointTimestamp)));e.pointsList=e.pointsList.concat("-",d,"-(",a,",",l,c,")")}return e.lastCheckPointTimestamp=i,e},{lastCheckPointTimestamp:(s||(s=o("I64"))).zero,pointsList:""}).pointsList}var g=s.of_string("2");function h(e){var t=e.traceType,n=(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").TASK))?"send":(s||(s=o("I64"))).equal(t,o("ArmadilloDataTraceType").armadilloMessageSend)?"armadillo send":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_UPLOAD))?"encrypted_backups_upload":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_RESTORE))?"encrypted_backups_restore":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_MEDIA_BACKUP))?"encrypted_backups_media_backup":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").SAP_VESTA_LOGIN))?"sap_vesta_login":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").SAP_VESTA_REGISTRATION))?"sap_vesta_registration":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_MEDIA_RESTORE))?"encrypted_backups_media_restore":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_INIT))?"shadow_encrypted_backups_init":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_ADD_DEVICE))?"shadow_encrypted_backups_add_device":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_UPLOAD))?"shadow_encrypted_backups_upload":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_RESTORE))?"shadow_encrypted_backups_restore":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_DELETE_BACKUP))?"shadow_encrypted_backups_delete_backup":e.contextTwo;return n}function y(e,t){var n=t.traceId,r=t.shouldFlush,a=h(t),i=t.traceType,l=(s||(s=o("I64"))).equal(i,o("ArmadilloDataTraceType").armadilloMessageSend)?"tam_message_send":t.contextOne,u=(s||(s=o("I64"))).equal(t.traceType,g)?void 0:t.predefinedId,c=t.initTimestampMs;return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.data_trace_addon.index("traceIdAddonId")).getKeyRange(n)).then(function(e){var t=_(e,r,c),n=t[0],o=t[1],a=t[3],i=t[4],l=e.length,s=f(e)}).then(function(){return e.data_trace_meta.delete(n)})}function C(t,r){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.data_trace_meta).getKeyRange(r)).then(function(r){return r!=null?y(t,r):(e||(e=n("Promise"))).resolve()})}var b={contents:void 0};function v(e){return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.data_trace_meta.index("shouldFlushInitTimestampMsTraceId")).getKeyRange(!1).bounds({lt:o("ReQL").key((s||(s=o("I64"))).sub(s.of_float(Date.now()),d))})).then(function(e){if(r("gkx")("23914")){var t=(s||(s=o("I64"))).of_float(Date.now());return e.filter(function(e){var n=h(e);if(n!=null&&p.has(n)){var r=(s||(s=o("I64"))).compare(s.sub(t,e.initTimestampMs),m)>=0;return r}return!0})}return e})}function S(e){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=yield v(t.tables);if(r.length!==0)return t.runInTransaction(function(t){return v(t).then(function(r){return(e||(e=n("Promise"))).all(r.map(function(e){return y(t,e)}))})},"readwrite",void 0,void 0,i.id+":287")}),R.apply(this,arguments)}function L(){var e=b.contents;if(e!=null){r("clearTimeout")(e);return}}function E(e){return r("promiseDone")(S(e),function(){L();var t=r("setTimeout")(function(){E(e)},6e4);b.contents=t},function(){L(),(u||(u=o("ODS"))).bumpEntityKey(3185,"mw_trace","error")}),L}var k=C,I=E,T={flush:k,flushExpiredDataTraces:I};l.default=T}),98);
__d("bumpVultureJSHash",["ODS"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){(e||(e=o("ODS"))).bumpEntityKey(7506,"vulture_js",t,n)}l.default=s}),98);